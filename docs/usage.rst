How to use HiCmappTools?
=============================

Quick start
-----

::

    hicmaptools -in_map in.binmap -in_bin in.bins QUERY_MODE query.bed -output out_file.tsv  
    
    input:  
            -in_map      text .n_contact or binary .bimap by genBiMap commend 
            -in_bin      the bin file for contact map, .bins
    
    OR
    
    hicmaptools -in_hic_name in.hic -in_hic_norm <NONE/VC/VC_SQRT/KR> -in_hic_res <1000/5000/10000> QUERY_MODE query.bed -output out_file.tsv

    input:
            -in_hic      .hic file generated by Juicer
            -in_hic_norm      specified normalization to extract data from .hic file. (default: NONE)
            -in_hic_rsol       specified resolution to extract data from .hic file. (default: 10000)
        
    QUERY_MODE: 
            -bat         calculate average contacts from downstream to upstream of interested position
        
            -local       list all contacts inside an interval

            -loop        contact intensity between two ends of a loop
            
            -pair        contacts between a pair region
            
            -sites       contacts between sites

            -submap      sub contact map of interested regions

            -TAD         sum and average of contacts inside TAD region
        
    other parameters:
            -ner_bin     check neighbouring bins for bat mode, default=10
            -random      the size of the shffule sample, default=100


Query Modes
-----------

`bed format <https://genome.ucsc.edu/FAQ/FAQformat.html#format1>`__ :
first three required columns are enough.

-bat
''''

-  calculate average contacts from downstream to upstream (controled by -ner_bin) of interested position (white rectangle)
-  i.e., PcG binding sites

-local
''''''

-  list all contacts inside an interval (white cross)
-  i.e., check intra-contacts of a TAD

-loop
'''''

-  contact intensity between two ends of a loop
-  i.e., check whether 5’ & 3’ of a gene form loop or not

-pair
'''''''

-  contacts between a pair region (contact between pair *X* and pair *Y*, white cross)
-  i.e., contact between a enhancer and a promoter

-sites
''''''

-  contact between sites (contacts between three sites, including diagonal)
-  i.e., contacts of insulator sites

-submap
'''''''

-  sub contact map of interested regions
-  i.e., extract sub contact map of 3R:10~15MB

-TAD
''''

-  sum and average of contacts inside TAD region (white dashed square at top right)
-  i.e., whether PcG/Active TADs show different contact property

Illustration of query modes

.. figure:: figs/queryOption.png
      :scale: 35 %
      :alt: Illustration of query modes


-output
'''''''

There are two output files

- specificOutput.tsv: the contact intensity of you interested
- specificOutput **_random** .tsv: the contact intensities of the null hypothesis


Command examples
-----------

BAT query
''''

Suppose you have below files and want to query ``-bat``:

- map file : nm\_none\_30000.n\_contact
- bin file : 30000.cbins
- query file : BATtest.txt

Then use the command
::

>hicmaptools -in_map nm_none_30000.n_contact -in_bin 30000.cbins -bat BATtest.txt -output temp.tsv

More queries
''''

::

>runExampl.sh -in_map nm_none_30000.n_contact -in_bin 30000.cbins -bat BATtest.txt -output temp.tsv

TAD loop in the manuscript
''''

We calculate the contact intensity between two boundaries of the TADs via the loop query mode

- map file (binary format): `fly.bimap <https://figshare.com/s/1e045bbab7b6c5e3e880>`_
- bin file : `fly.bins <https://figshare.com/s/1e045bbab7b6c5e3e880>`_
- query file : `epiTAD.bed <https://figshare.com/s/1e045bbab7b6c5e3e880>`_

::

>hicmaptools -in_map fly.bimap -in_bin fly.bins -loop epiTAD.bed -random 1 -output TADloop_cm_10k_top5.tsv &> TADloop.log
>Rscript plot_TADLoop.R

TAD intra-density in the manuscript
''''

We check whether intra-TAD contact intensity also shows differently across epi-classes via the TAD query mode

- map file (binary format): `fly.bimap <https://figshare.com/s/1e045bbab7b6c5e3e880>`_
- bin file : `fly.bins <https://figshare.com/s/1e045bbab7b6c5e3e880>`_
- query file : `epiTAD.bed <https://figshare.com/s/1e045bbab7b6c5e3e880>`_

::

>hicmaptools -in_map fly.bimap -in_bin fly.bins -TAD epiTAD.bed -random 0 -output TADintra_cm_10k_top5.tsv &> TADintra.log
>Rscript plot_TADintra.R


